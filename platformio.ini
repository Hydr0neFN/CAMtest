; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

; ============================================================
; Shared base — common to both camera roles
; ============================================================
[env_base]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board = esp32cam
framework = arduino
lib_deps = https://github.com/espressif/esp32-camera.git#v2.0.12
monitor_speed = 115200
board_build.f_cpu = 240000000L

; --- Build speed ---
; PlatformIO has built-in ccache support. Enable it globally in PlatformIO
; settings: PlatformIO IDE -> Settings -> "Enable ccache" (or set
; pio_system_env = ccache in ~/.platformio/penv/lib/python*/site-packages/
; platformio/misc/). The build_cache_dir below tells SCons where to keep
; the object-file cache for incremental rebuilds.
build_cache_dir = .pio/cache

; --- Optimisation flags ---
; -O2          : optimise for speed (default Arduino-ESP32 is often -Os/size)
; -g           : keep full DWARF debug info for GDB / crash decoder
; -ffunction-sections / -fdata-sections : strip dead code (linker --gc-sections
;   is already added by the ESP-IDF toolchain)
build_flags =
    -DCONFIG_SCCB_CLK_FREQ=100000
    -DCONFIG_CAMERA_DMA_BUFFER_SIZE_MAX=32768
    -DCONFIG_CAMERA_TASK_STACK_SIZE=2048
    -DCONFIG_CAMERA_CORE0=1
    -DCONFIG_CAMERA_JPEG_MODE_FRAME_SIZE=8192
    -DCORE_DEBUG_LEVEL=4
    -O2
    -g
    -ffunction-sections
    -fdata-sections

; ============================================================
; Primary camera — receives UART blob data, does triangulation
; Flash this to the RIGHT camera (UART1 RX on GPIO13)
; ============================================================
[env:primary]
extends = env_base
build_flags =
    ${env_base.build_flags}
    -DCAM_ROLE_PRIMARY

; ============================================================
; Secondary camera — sends blob centroids over UART (GPIO1 TX)
; Flash this to the LEFT camera
; ============================================================
[env:secondary]
extends = env_base
build_flags =
    ${env_base.build_flags}
    -DCAM_ROLE_SECONDARY
